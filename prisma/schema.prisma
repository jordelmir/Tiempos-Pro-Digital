generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AppUser {
  id              String   @id @default(uuid())
  auth_uid        String   @unique
  name            String
  email           String?  @unique
  role            String   @default("User") // Admin, Banker, User
  balance_bigint  BigInt   @default(0)
  status          String   @default("Active")
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt

  bets            Bet[]
  ledger          LedgerTransaction[]
  auditLogs       AuditLog[]

  @@map("app_users")
}

model Bet {
  id              String   @id @default(uuid())
  user_id         String
  amount_bigint   BigInt
  numbers         String   // e.g. "95"
  mode            String   // e.g. "Mediodía:::TIEMPOS"
  ticket_code     String   @unique
  status          String   @default("PENDING") // PENDING, WON, LOST
  created_at      DateTime @default(now())

  user            AppUser  @relation(fields: [user_id], references: [id])

  @@map("bets")
}

model DrawResult {
  id              String   @id @default(uuid())
  date            String   // YYYY-MM-DD
  drawTime        String   // Mediodía, Tarde, Noche
  winningNumber   Int
  isReventado     Boolean  @default(false)
  reventadoNumber Int?
  status          String   @default("CLOSED")
  created_at      DateTime @default(now())

  @@unique([date, drawTime])
  @@map("draw_results")
}

model AuditLog {
  id              String   @id @default(uuid()) // event_id usually
  timestamp       DateTime
  actor_id        String
  actor_name      String?
  actor_role      String?
  action          String
  type            String
  severity        String
  target_resource String?
  metadata        Json?
  ip_address      String?

  actor           AppUser? @relation(fields: [actor_id], references: [id])

  @@map("audit_trail")
}

model LedgerTransaction {
  id              String   @id @default(uuid())
  user_id         String
  amount_bigint   BigInt
  balance_before  BigInt
  balance_after   BigInt
  type            String   // DEPOSIT, WITHDRAWAL, BET, PRIZE
  reference_id    String?
  ticket_code     String?
  meta            Json?
  created_at      DateTime @default(now())

  user            AppUser  @relation(fields: [user_id], references: [id])

  @@map("ledger_transactions")
}

model SystemSetting {
  key             String   @id
  value           Json
  updated_at      DateTime @default(now())
  updated_by      String?

  @@map("system_settings")
}
